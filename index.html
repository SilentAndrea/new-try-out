<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily - 日程管理</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ==================== 原有样式调整 ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Share+Tech+Mono&display=swap');
        
        :root {
            --primary-color: #1a1a2e;
            --secondary-color: #16213e;
            --accent-color: #0ea5e9;
            --light-color: #f8fafc;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --border-radius: 16px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.1);
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            --font-size: 15px;
            --surface: #ffffff;
            --surface-secondary: #f8fafc;
            --border: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --task-opacity: 0.95;
            --bg-opacity: 0.2;
        }
        
        body {
            background-color: #f1f5f9;
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: var(--font-size);
            padding: 20px;
            overflow-x: hidden;
            font-family: 'Caveat', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
        }
        
        .app-container {
            width: 100%;
            max-width: 900px;
            height: 92vh;
            background-color: var(--surface);
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid var(--border);
            touch-action: pan-y;
        }
        
        .page {
            flex: 1;
            padding: 32px;
            display: none;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        .page.active {
            display: flex;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            position: relative;
            z-index: 2;
        }
        
        /* 调整今日待办标题透明度 */
        .page-title {
            font-size: 42px;
            font-weight: 700;
            color: var(--primary-color);
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 2;
            font-family: 'Caveat', cursive;
            opacity: 0.9; /* 添加透明度 */
        }
        
        #page-today.active {
            display: flex;
        }
        
        /* 调整日期显示为黑色 */
        .date-display {
            color: #000000; /* 改为黑色 */
            font-size: calc(var(--font-size) + 4px);
            font-weight: 500;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            z-index: 2;
            font-family: 'Caveat', cursive;
            opacity: 0.85; /* 稍微降低一点透明度 */
        }
        
        .date-display i {
            color: var(--accent-color);
        }
        
        .tasks-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 12px;
            position: relative;
            z-index: 1;
            touch-action: pan-y;
        }
        
        .tasks-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .tasks-container::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .tasks-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        
        .page-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            opacity: var(--bg-opacity);
            z-index: 0;
            transition: opacity 0.3s ease;
        }
        
        .page-content {
            position: relative;
            z-index: 1;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* 简洁清单样式 */
        .simple-task-wrapper {
            position: relative;
            width: 100%;
            margin-bottom: 16px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .simple-task-container {
            display: flex;
            width: 100%;
            position: relative;
            transform: translateX(0);
            transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1);
        }
        
        .simple-task-item {
            display: flex;
            align-items: center;
            padding: 20px;
            background-color: rgba(255, 255, 255, var(--task-opacity));
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            width: 100%;
            flex-shrink: 0;
            z-index: 2;
        }
        
        .simple-task-item:hover {
            background-color: rgba(255, 255, 255, 1);
            border-color: var(--accent-color);
        }
        
        .checkbox-container {
            width: 24px;
            margin-right: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .simple-task-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            position: relative;
        }
        
        .simple-task-checkbox.checked {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .simple-task-checkbox.checked i {
            color: white;
            font-size: 14px;
            opacity: 1;
            transform: scale(1);
        }
        
        .simple-task-checkbox i {
            opacity: 0;
            transform: scale(0.5);
            transition: var(--transition);
        }
        
        .simple-task-content {
            flex: 1;
            font-size: calc(var(--font-size) + 4px);
            line-height: 1.6;
            font-weight: 500;
            color: var(--text-primary);
            transition: var(--transition);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-family: 'Caveat', cursive;
        }
        
        .simple-task-item.completed .simple-task-checkbox.checked i {
            opacity: 1;
            transform: scale(1);
        }
        
        .simple-task-item.completed .simple-task-content {
            text-decoration: line-through;
            color: #94a3b8;
        }
        
        /* 删除指示器 */
        .delete-indicator {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--danger-color);
            font-size: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .swipe-to-delete .delete-indicator {
            opacity: 1;
        }
        
        /* 滑动提示 */
        .swipe-instruction {
            position: absolute;
            bottom: 100px;
            left: 0;
            right: 0;
            text-align: center;
            color: var(--text-secondary);
            font-size: calc(var(--font-size) + 2px);
            z-index: 5;
            opacity: 0.8;
            pointer-events: none;
            animation: pulse 2s infinite;
            font-family: 'Caveat', cursive;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        /* 删除动画 */
        @keyframes slideOutLeft {
            0% { 
                opacity: 1;
                transform: translateX(0);
                max-height: 100px;
                margin-bottom: 16px;
            }
            100% { 
                opacity: 0;
                transform: translateX(-100%);
                max-height: 0;
                margin-bottom: 0;
                padding-top: 0;
                padding-bottom: 0;
            }
        }
        
        .deleting {
            animation: slideOutLeft 0.3s ease-out forwards;
            overflow: hidden;
        }
        
        /* ==================== 四象限坐标系样式 ==================== */
        
        .quadrant-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 16px;
            height: 100%;
            min-height: 500px;
        }
        
        .quadrant-section {
            background-color: rgba(255, 255, 255, var(--task-opacity));
            border-radius: var(--border-radius);
            padding: 24px;
            display: flex;
            flex-direction: column;
            border: 2px solid transparent;
            transition: var(--transition);
            overflow: hidden;
            position: relative;
            backdrop-filter: blur(10px);
        }
        
        .quadrant-section:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .quadrant-1 {
            border-color: #ef4444;
            background-color: rgba(239, 68, 68, 0.05);
        }
        
        .quadrant-2 {
            border-color: #f59e0b;
            background-color: rgba(245, 158, 11, 0.05);
        }
        
        .quadrant-3 {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.05);
        }
        
        .quadrant-4 {
            border-color: #10b981;
            background-color: rgba(16, 185, 129, 0.05);
        }
        
        .quadrant-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }
        
        .quadrant-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 18px;
            color: white;
        }
        
        .quadrant-1 .quadrant-icon {
            background-color: #ef4444;
        }
        
        .quadrant-2 .quadrant-icon {
            background-color: #f59e0b;
        }
        
        .quadrant-3 .quadrant-icon {
            background-color: #3b82f6;
        }
        
        .quadrant-4 .quadrant-icon {
            background-color: #10b981;
        }
        
        .quadrant-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'Caveat', cursive;
        }
        
        .quadrant-subtitle {
            font-size: calc(var(--font-size) + 2px);
            color: var(--text-secondary);
            margin-top: 4px;
            font-family: 'Caveat', cursive;
        }
        
        .quadrant-tasks {
            flex: 1;
            overflow-y: auto;
            padding-right: 8px;
        }
        
        .quadrant-tasks::-webkit-scrollbar {
            width: 4px;
        }
        
        .quadrant-tasks::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .quadrant-tasks::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        
        .quadrant-task-item {
            display: flex;
            align-items: center;
            padding: 16px;
            margin-bottom: 12px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: var(--transition);
            cursor: pointer;
        }
        
        .quadrant-task-item:hover {
            background-color: rgba(255, 255, 255, 0.95);
            transform: translateX(5px);
        }
        
        .quadrant-task-item.completed .quadrant-task-content {
            text-decoration: line-through;
            color: #94a3b8;
        }
        
        .quadrant-task-content {
            flex: 1;
            font-size: calc(var(--font-size) + 4px);
            line-height: 1.5;
            font-weight: 500;
            color: var(--text-primary);
            font-family: 'Caveat', cursive;
        }
        
        .quadrant-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-family: 'Caveat', cursive;
            font-size: calc(var(--font-size) + 4px);
        }
        
        .quadrant-empty i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }
        
        /* 添加四象限坐标轴指示 */
        .quadrant-axes {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .axis-label {
            position: absolute;
            font-family: 'Caveat', cursive;
            font-size: calc(var(--font-size) + 2px);
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .important-label {
            top: 50%;
            left: 10px;
            transform: translateY(-50%) rotate(-90deg);
            transform-origin: left center;
        }
        
        .urgent-label {
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        /* 优先级清单样式 */
        .priority-task-wrapper {
            position: relative;
            width: 100%;
            margin-bottom: 16px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .priority-task-container {
            display: flex;
            width: 100%;
            position: relative;
            transform: translateX(0);
            transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1);
        }
        
        .priority-task-item {
            display: flex;
            align-items: center;
            padding: 20px;
            background-color: rgba(255, 255, 255, var(--task-opacity));
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            width: 100%;
            flex-shrink: 0;
            z-index: 2;
        }
        
        .priority-task-item:hover {
            background-color: rgba(255, 255, 255, 1);
        }
        
        .priority-indicator {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            flex-shrink: 0;
            color: white;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .priority-high {
            background-color: #ef4444; /* 红色 - 高优先级 */
        }
        
        .priority-medium {
            background-color: #f59e0b; /* 橙色 - 中优先级 */
        }
        
        .priority-low {
            background-color: #10b981; /* 绿色 - 低优先级 */
        }
        
        .priority-task-content {
            flex: 1;
            font-size: calc(var(--font-size) + 4px);
            line-height: 1.6;
            font-weight: 500;
            color: var(--text-primary);
            transition: var(--transition);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-family: 'Caveat', cursive;
        }
        
        .priority-task-item.completed .priority-task-content {
            text-decoration: line-through;
            color: #94a3b8;
        }
        
        /* 通用删除按钮样式 */
        .delete-action {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 80px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            border-radius: var(--border-radius);
            cursor: pointer;
            z-index: 1;
            box-shadow: -5px 0 15px rgba(239, 68, 68, 0.2);
            display: none;
        }
        
        #page-settings {
            display: none;
        }
        
        #page-settings.active {
            display: flex;
        }
        
        .list-format-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .format-option {
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 28px 24px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--surface);
            height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .format-option:hover {
            border-color: var(--accent-color);
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }
        
        .format-option.selected {
            border-color: var(--accent-color);
            background-color: rgba(14, 165, 233, 0.05);
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.1);
        }
        
        .format-icon {
            font-size: 36px;
            color: var(--accent-color);
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--accent-color) 0%, #0284c7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .format-name {
            font-weight: 700;
            font-size: 24px;
            color: var(--primary-color);
            margin-bottom: 8px;
            font-family: 'Caveat', cursive;
        }
        
        .format-desc {
            font-size: calc(var(--font-size) + 2px);
            color: var(--text-secondary);
            line-height: 1.5;
            font-family: 'Caveat', cursive;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .settings-section {
            background-color: var(--surface-secondary);
            border-radius: var(--border-radius);
            padding: 32px;
            margin-top: 30px;
            border: 1px solid var(--border);
        }
        
        .settings-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 28px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'Caveat', cursive;
        }
        
        .settings-title i {
            color: var(--accent-color);
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: calc(var(--font-size) + 4px);
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Caveat', cursive;
        }
        
        .setting-label i {
            color: var(--accent-color);
            width: 24px;
        }
        
        select, input[type="time"], input[type="text"], input[type="number"] {
            padding: 12px 18px;
            border-radius: 12px;
            border: 1px solid var(--border);
            font-size: calc(var(--font-size) + 2px);
            background-color: var(--surface);
            color: var(--text-primary);
            transition: var(--transition);
            min-width: 180px;
            font-family: 'Caveat', cursive;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }
        
        input[type="range"] {
            width: 160px;
            height: 8px;
            -webkit-appearance: none;
            background: #e2e8f0;
            border-radius: 10px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(14, 165, 233, 0.3);
        }
        
        .btn {
            padding: 14px 28px;
            border-radius: 12px;
            border: none;
            font-size: calc(var(--font-size) + 4px);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Caveat', cursive;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color) 0%, #0284c7 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(14, 165, 233, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.4);
        }
        
        .btn-secondary {
            background-color: var(--surface);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background-color: var(--surface-secondary);
            transform: translateY(-2px);
        }
        
        .btn-small {
            padding: 10px 20px;
            font-size: calc(var(--font-size) + 2px);
        }
        
        .nav-button {
            position: absolute;
            top: 32px;
            right: 32px;
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--accent-color) 0%, #0284c7 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.3);
            transition: var(--transition);
            z-index: 10;
        }
        
        .nav-button:hover {
            transform: scale(1.05) rotate(90deg);
            box-shadow: 0 15px 30px rgba(14, 165, 233, 0.4);
        }
        
        .bg-custom-controls {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .file-upload-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .file-upload-label {
            padding: 12px 20px;
            background-color: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            color: var(--text-primary);
            font-family: 'Caveat', cursive;
            font-size: calc(var(--font-size) + 2px);
        }
        
        .file-upload-label:hover {
            background-color: var(--surface-secondary);
            border-color: var(--accent-color);
        }
        
        .file-upload-label i {
            color: var(--accent-color);
        }
        
        .file-upload-input {
            display: none;
        }
        
        .file-name {
            font-size: calc(var(--font-size) + 1px);
            color: var(--text-secondary);
            margin-left: 10px;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-family: 'Caveat', cursive;
        }
        
        .opacity-control {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 10px;
        }
        
        .opacity-value {
            min-width: 50px;
            text-align: center;
            font-weight: 700;
            color: var(--accent-color);
            background-color: rgba(14, 165, 233, 0.1);
            padding: 6px 12px;
            border-radius: 8px;
            font-family: 'Caveat', cursive;
            font-size: calc(var(--font-size) + 2px);
        }
        
        @media (max-width: 768px) {
            .app-container {
                height: 96vh;
                border-radius: 20px;
            }
            
            .page {
                padding: 24px;
            }
            
            .list-format-options {
                grid-template-columns: 1fr;
            }
            
            .quadrant-grid {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(4, auto);
                min-height: auto;
            }
            
            .quadrant-axes {
                display: none; /* 在小屏幕上隐藏坐标轴 */
            }
            
            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            select, input[type="time"], input[type="text"], input[type="number"] {
                width: 100%;
                min-width: auto;
            }
            
            .nav-button {
                top: 24px;
                right: 24px;
                width: 50px;
                height: 50px;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .task-wrapper {
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: var(--surface);
            border-radius: 24px;
            padding: 36px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
            transform: translateY(30px) scale(0.95);
            transition: var(--transition);
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0) scale(1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
        }
        
        .modal-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
            font-family: 'Caveat', cursive;
        }
        
        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background-color: var(--surface-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
        }
        
        .modal-close:hover {
            background-color: var(--danger-color);
            color: white;
            transform: rotate(90deg);
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: calc(var(--font-size) + 4px);
            font-family: 'Caveat', cursive;
        }
        
        .form-input {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid var(--border);
            font-size: calc(var(--font-size) + 4px);
            transition: var(--transition);
            font-family: 'Caveat', cursive;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }
        
        .form-textarea {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid var(--border);
            font-size: calc(var(--font-size) + 4px);
            transition: var(--transition);
            min-height: 120px;
            resize: vertical;
            font-family: 'Caveat', cursive;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }
        
        .form-select {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid var(--border);
            font-size: calc(var(--font-size) + 4px);
            background-color: var(--surface);
            color: var(--text-primary);
            transition: var(--transition);
            font-family: 'Caveat', cursive;
        }
        
        .form-select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }
        
        .form-buttons {
            display: flex;
            gap: 16px;
            margin-top: 36px;
        }
        
        .add-task-button {
            position: absolute;
            bottom: 32px;
            right: 32px;
            width: 64px;
            height: 64px;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--accent-color) 0%, #0284c7 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.3);
            transition: var(--transition);
            z-index: 10;
        }
        
        .add-task-button:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 15px 30px rgba(14, 165, 233, 0.4);
        }
        
        .hidden {
            display: none !important;
        }
        
        .bg-preview {
            width: 100%;
            height: 180px;
            border-radius: 16px;
            margin-top: 20px;
            background-size: cover;
            background-position: center;
            border: 2px solid var(--border);
            display: none;
            overflow: hidden;
        }
        
        .bg-preview.active {
            display: block;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 64px;
            margin-bottom: 24px;
            opacity: 0.3;
        }
        
        .empty-state h3 {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-secondary);
            font-family: 'Caveat', cursive;
            font-size: 32px;
        }
        
        .format-preview {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background-color: var(--surface-secondary);
            border-radius: var(--border-radius);
            border: 1px solid var(--border);
        }
        
        .swiping {
            transition: none !important;
        }
        
        .simple-reminder {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--accent-color) 0%, #0284c7 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.3);
            z-index: 1000;
            display: none;
            animation: slideInRight 0.3s ease-out;
            font-family: 'Caveat', cursive;
            font-size: calc(var(--font-size) + 4px);
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .settings-back-button {
            position: absolute;
            top: 32px;
            right: 32px;
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--accent-color) 0%, #0284c7 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.3);
            transition: var(--transition);
            z-index: 10;
        }
        
        .settings-back-button:hover {
            transform: scale(1.05) rotate(90deg);
            box-shadow: 0 15px 30px rgba(14, 165, 233, 0.4);
        }
        
        /* ==================== 番茄时钟专用样式 - 优化版 ==================== */
        
        #page-pomodoro {
            background-color: #ffffff;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 24px;
        }
        
        #page-pomodoro.active {
            display: flex;
        }
        
        /* 专注模式容器 */
        .focus-mode-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            transition: all 0.5s ease;
        }
        
        /* 普通模式容器 */
        .normal-mode-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            transition: all 0.5s ease;
        }
        
        /* 切换模式 */
        #page-pomodoro.normal-mode .normal-mode-container {
            display: flex;
        }
        
        #page-pomodoro.normal-mode .focus-mode-container {
            display: none;
        }
        
        #page-pomodoro.focus-mode .normal-mode-container {
            display: none;
        }
        
        #page-pomodoro.focus-mode .focus-mode-container {
            display: flex;
        }
        
        /* 倒计时显示 */
        .pomodoro-timer {
            font-size: 120px;
            font-weight: 500;
            color: #000000;
            font-family: 'Orbitron', 'Share Tech Mono', monospace;
            margin: 40px 0;
            letter-spacing: 4px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .focus-mode-container .pomodoro-timer {
            font-size: 140px;
            margin: 80px 0;
        }
        
        /* 进度环 */
        .progress-ring {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 30px auto;
        }
        
        .progress-ring svg {
            width: 100%;
            height: 100%;
        }
        
        .progress-ring circle {
            fill: none;
            stroke-width: 4;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 0.5s linear;
        }
        
        .progress-bg {
            stroke: rgba(0, 0, 0, 0.05);
        }
        
        .progress-fg {
            stroke: var(--accent-color);
        }
        
        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            font-weight: 500;
            color: #000000;
            font-family: 'Orbitron', 'Share Tech Mono', monospace;
        }
        
        /* 控制按钮 - 简化版，只有图标 */
        .pomodoro-controls {
            display: flex;
            gap: 40px;
            margin-top: 40px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* 简约按钮 - 只有黑色图标，没有背景 */
        .pomodoro-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
            color: #1a1a1a;
            font-size: 28px;
            position: relative;
        }
        
        .pomodoro-btn i {
            transition: all 0.3s ease;
        }
        
        /* 按钮悬停效果 */
        .pomodoro-btn:hover {
            transform: translateY(-5px);
        }
        
        .pomodoro-btn:hover i {
            color: var(--accent-color);
        }
        
        .pomodoro-btn:active {
            transform: translateY(-2px);
        }
        
        /* 专注模式暂停按钮 */
        #pomodoro-focus-pause {
            width: 70px;
            height: 70px;
            font-size: 32px;
        }
        
        /* 时间设置区域 - 优化布局，去掉标题 */
        .pomodoro-settings {
            margin-top: 50px;
            padding: 35px;
            background-color: #f8fafc;
            border-radius: 24px;
            width: 100%;
            max-width: 500px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* 时间输入框 - 优化布局，标签向左偏移对齐 */
        .time-inputs {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            align-items: flex-end;
        }
        
        .time-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
            max-width: 120px;
        }
        
        .time-input-label {
            font-size: calc(var(--font-size) + 2px);
            font-weight: 600;
            color: var(--text-secondary);
            font-family: 'Caveat', cursive;
            width: 100%;
            text-align: center;
            transform: translateX(-4px); /* 向左微调，与数字框对齐 */
            letter-spacing: 1px;
        }
        
        .time-input {
            width: 100%;
            padding: 18px 5px;
            border-radius: 12px;
            border: 2px solid rgba(0, 0, 0, 0.08);
            font-size: 28px;
            text-align: center;
            font-weight: 700;
            font-family: 'Orbitron', 'Share Tech Mono', monospace;
            color: var(--primary-color);
            background-color: #ffffff;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .time-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1), 
                        inset 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        /* 确认按钮 - 只有绿色勾 */
        .apply-container {
            text-align: center;
            margin-top: 20px;
        }
        
        #pomodoro-apply-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
            color: var(--success-color);
            font-size: 32px;
        }
        
        #pomodoro-apply-btn:hover {
            transform: translateY(-5px) scale(1.1);
        }
        
        #pomodoro-apply-btn:active {
            transform: translateY(-2px) scale(1.05);
        }
        
        /* 专注模式状态文本 */
        .focus-status {
            font-size: calc(var(--font-size) + 6px);
            color: var(--text-secondary);
            font-family: 'Caveat', cursive;
            margin-top: 30px;
            text-align: center;
            opacity: 0.8;
        }
        
        /* 返回按钮 - 简化版 */
        .pomodoro-back-button {
            position: absolute;
            top: 32px;
            right: 32px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: transparent;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: var(--transition);
            z-index: 10;
            border: 2px solid transparent;
        }
        
        .pomodoro-back-button:hover {
            transform: scale(1.1);
            color: var(--accent-color);
            border-color: rgba(14, 165, 233, 0.2);
        }
        
        /* 番茄时钟动画 */
        @keyframes pulse-timer {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .pomodoro-timer.active {
            animation: pulse-timer 2s infinite;
            color: var(--accent-color);
        }
        
        /* 响应式调整 - 番茄时钟 */
        @media (max-width: 768px) {
            .pomodoro-timer {
                font-size: 80px;
            }
            
            .focus-mode-container .pomodoro-timer {
                font-size: 100px;
                margin: 60px 0;
            }
            
            .progress-ring {
                width: 250px;
                height: 250px;
            }
            
            .timer-text {
                font-size: 50px;
            }
            
            .pomodoro-btn {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }
            
            #pomodoro-focus-pause {
                width: 60px;
                height: 60px;
                font-size: 28px;
            }
            
            #pomodoro-apply-btn {
                width: 55px;
                height: 55px;
                font-size: 28px;
            }
            
            .time-input {
                font-size: 24px;
                padding: 15px 5px;
            }
            
            .time-input-label {
                font-size: calc(var(--font-size) + 1px);
            }
            
            .focus-status {
                font-size: calc(var(--font-size) + 4px);
            }
        }
        
        @media (max-width: 480px) {
            .pomodoro-timer {
                font-size: 70px;
            }
            
            .focus-mode-container .pomodoro-timer {
                font-size: 85px;
                margin: 50px 0;
            }
            
            .progress-ring {
                width: 220px;
                height: 220px;
            }
            
            .timer-text {
                font-size: 45px;
            }
            
            .time-inputs {
                gap: 10px;
            }
            
            .time-input-group {
                max-width: 90px;
            }
            
            .time-input {
                width: 100%;
                font-size: 22px;
                padding: 12px 5px;
            }
            
            .pomodoro-controls {
                gap: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container" id="app-container">
        <!-- 第一页：当日待办清单 -->
        <div class="page active" id="page-today">
            <!-- 背景图层 -->
            <div class="page-background" id="today-background"></div>
            
            <div class="page-content">
                <div class="page-header">
                    <div>
                        <div class="date-display" id="current-date">
                            <i class="fas fa-calendar-day"></i>
                            <span id="date-text"></span>
                        </div>
                        <h1 class="page-title" id="today-title">今日待办</h1>
                    </div>
                </div>
                
                <div class="tasks-container" id="today-tasks">
                    <!-- 任务将通过JavaScript动态添加 -->
                </div>
            </div>
            
            <!-- 添加任务按钮（仅在今日页面显示） -->
            <div class="add-task-button" id="add-task-button">
                <i class="fas fa-plus"></i>
            </div>
            
            <!-- 滑动提示 -->
            <div class="swipe-instruction" id="swipe-instruction">
                <i class="fas fa-arrow-left"></i> 左滑删除任务
            </div>
            
            <!-- 导航按钮（今日页面） -->
            <div class="nav-button" id="nav-button">
                <i class="fas fa-cog"></i>
            </div>
        </div>
        
        <!-- 第二页：设置 -->
        <div class="page" id="page-settings">
            <div class="page-header">
                <h1 class="page-title" id="settings-title">设置</h1>
            </div>
            
            <div>
                <h3 style="margin-bottom: 20px; color: var(--primary-color); font-size: 32px; font-weight: 700;" id="format-title">
                    <i class="fas fa-palette" style="margin-right: 10px; color: var(--accent-color);"></i>
                    选择清单格式
                </h3>
                <div class="list-format-options">
                    <div class="format-option selected" data-format="simple">
                        <div class="format-icon"><i class="fas fa-list"></i></div>
                        <div class="format-name" id="simple-format-name">简洁清单</div>
                        <div class="format-desc" id="simple-format-desc">单列任务清单</div>
                    </div>
                    
                    <div class="format-option" data-format="quadrant">
                        <div class="format-icon"><i class="fas fa-th-large"></i></div>
                        <div class="format-name" id="quadrant-format-name">四象限法</div>
                        <div class="format-desc" id="quadrant-format-desc">按重要紧急程度管理</div>
                    </div>
                    
                    <div class="format-option" data-format="priority">
                        <div class="format-icon"><i class="fas fa-flag"></i></div>
                        <div class="format-name" id="priority-format-name">优先级清单</div>
                        <div class="format-desc" id="priority-format-desc">按优先级分组排序任务</div>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <h3 class="settings-title" id="settings-section-title">
                    <i class="fas fa-sliders-h"></i>
                    个性化设置
                </h3>
                
                <div class="setting-item">
                    <div class="setting-label">
                        <i class="fas fa-language"></i>
                        <span id="language-label">应用语言</span>
                    </div>
                    <select id="language-select">
                        <option value="zh-CN" selected>简体中文</option>
                        <option value="en">English</option>
                    </select>
                </div>
                
                <div class="setting-item">
                    <div class="setting-label">
                        <i class="fas fa-image"></i>
                        <span id="background-label">清单背景图</span>
                    </div>
                </div>
                
                <div class="bg-custom-controls">
                    <div class="file-upload-container">
                        <label for="local-image-upload" class="file-upload-label">
                            <i class="fas fa-folder-open"></i>
                            <span id="choose-local-image-text">选择本地图片</span>
                        </label>
                        <input type="file" id="local-image-upload" class="file-upload-input" accept="image/*">
                        <span class="file-name" id="file-name"></span>
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 10px;">
                        <button class="btn btn-secondary btn-small" id="clear-bg">
                            <i class="fas fa-times"></i>
                            <span id="clear-bg-text">清除背景</span>
                        </button>
                        <button class="btn btn-primary btn-small" id="save-bg">
                            <i class="fas fa-save"></i>
                            <span id="save-bg-text">保存背景</span>
                        </button>
                    </div>
                </div>
                
                <!-- 背景透明度控制 -->
                <div class="setting-item">
                    <div class="setting-label">
                        <i class="fas fa-adjust"></i>
                        <span id="bg-opacity-label">背景透明度</span>
                    </div>
                    <div class="opacity-control">
                        <span class="opacity-value" id="bg-opacity-value">20%</span>
                        <input type="range" id="bg-opacity-slider" min="5" max="80" value="20" step="5">
                    </div>
                </div>
                
                <!-- 任务条透明度控制 -->
                <div class="setting-item">
                    <div class="setting-label">
                        <i class="fas fa-layer-group"></i>
                        <span id="task-opacity-label">任务条透明度</span>
                    </div>
                    <div class="opacity-control">
                        <span class="opacity-value" id="task-opacity-value">95%</span>
                        <input type="range" id="task-opacity-slider" min="50" max="100" value="95" step="5">
                    </div>
                </div>
                
                <!-- 番茄时钟设置 -->
                <div class="setting-item">
                    <div class="setting-label">
                        <i class="fas fa-clock"></i>
                        <span id="pomodoro-label">番茄时钟</span>
                    </div>
                    <button class="btn btn-primary" id="pomodoro-btn">
                        <i class="fas fa-play"></i>
                        <span id="pomodoro-btn-text">开启专注</span>
                    </button>
                </div>
                
                <div class="bg-preview" id="bg-preview"></div>
            </div>
            
            <!-- 返回按钮（设置页面） -->
            <div class="settings-back-button" id="settings-back-button">
                <i class="fas fa-calendar-day"></i>
            </div>
        </div>
        
        <!-- 第三页：番茄时钟 - 独立的页面 -->
        <div class="page" id="page-pomodoro">
            <!-- 普通模式 -->
            <div class="normal-mode-container">
                <!-- 倒计时显示 -->
                <div class="pomodoro-timer" id="pomodoro-timer">00:25:00</div>
                
                <!-- 控制按钮 -->
                <div class="pomodoro-controls">
                    <button class="pomodoro-btn" id="pomodoro-start-btn" title="开始">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="pomodoro-btn" id="pomodoro-pause-btn" title="暂停">
                        <i class="fas fa-pause"></i>
                    </button>
                    <button class="pomodoro-btn" id="pomodoro-reset-btn" title="重置">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
                
                <!-- 时间设置 - 去掉标题 -->
                <div class="pomodoro-settings">
                    <!-- 去掉标题 -->
                    <div class="time-inputs">
                        <div class="time-input-group">
                            <label class="time-input-label">时</label>
                            <input type="number" id="pomodoro-hours" class="time-input" min="0" max="10" value="0">
                        </div>
                        
                        <div class="time-input-group">
                            <label class="time-input-label">分</label>
                            <input type="number" id="pomodoro-minutes" class="time-input" min="0" max="59" value="25">
                        </div>
                        
                        <div class="time-input-group">
                            <label class="time-input-label">秒</label>
                            <input type="number" id="pomodoro-seconds" class="time-input" min="0" max="59" value="0">
                        </div>
                    </div>
                    
                    <div class="apply-container">
                        <button class="pomodoro-btn" id="pomodoro-apply-btn" title="应用设置">
                            <i class="fas fa-check" style="color: #10b981;"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 专注模式 -->
            <div class="focus-mode-container">
                <!-- 进度环 -->
                <div class="progress-ring">
                    <svg>
                        <circle class="progress-bg" cx="150" cy="150" r="145"></circle>
                        <circle class="progress-fg" id="progress-circle" cx="150" cy="150" r="145"></circle>
                    </svg>
                    <div class="timer-text" id="focus-timer">00:25:00</div>
                </div>
                
                <!-- 状态文本 -->
                <div class="focus-status" id="focus-status">专注中...</div>
                
                <!-- 暂停按钮 -->
                <div class="pomodoro-controls">
                    <button class="pomodoro-btn" id="pomodoro-focus-pause" title="暂停">
                        <i class="fas fa-pause"></i>
                    </button>
                </div>
            </div>
            
            <!-- 返回按钮 -->
            <div class="pomodoro-back-button" id="pomodoro-back-button">
                <i class="fas fa-cog"></i>
            </div>
        </div>
    </div>
    
    <!-- 添加任务模态框 -->
    <div class="modal-overlay" id="add-task-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">添加新任务</h2>
                <div class="modal-close" id="modal-close">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="task-text" id="task-text-label">任务内容（每行一个任务）</label>
                <textarea id="task-text" class="form-textarea" placeholder="输入任务内容，每行一个任务...&#10;例如：&#10;完成项目报告&#10;回复工作邮件&#10;准备会议材料"></textarea>
                <div class="multi-task-hint">提示：每行输入一个任务，可以一次性添加多个任务</div>
            </div>
            
            <!-- 动态分类选项，根据清单格式变化 -->
            <div class="form-group hidden" id="task-classification-group">
                <label class="form-label" id="task-classification-label">分类</label>
                <select id="task-classification" class="form-select">
                    <!-- 选项将根据清单格式动态填充 -->
                </select>
            </div>
            
            <div class="form-buttons">
                <button class="btn btn-secondary" id="cancel-btn"><span id="cancel-btn-text">取消</span></button>
                <button class="btn btn-primary" id="save-task-btn"><span id="save-btn-text">保存任务</span></button>
            </div>
        </div>
    </div>
    
    <!-- 简单提醒 -->
    <div class="simple-reminder" id="simple-reminder">
        <i class="fas fa-bell"></i>
        <span id="reminder-text">提醒：现在是查看任务的时间！</span>
    </div>

    <script>
        // 应用状态管理
        const AppState = {
            currentPage: 'today',
            tasks: [],
            settings: {
                language: 'zh-CN',
                currentFormat: 'simple',
                fontSize: 16,
                reminderTime: '09:00',
                completionEffect: 'both',
                background: 'none',
                customBackground: '',
                bgOpacity: 0.2,
                taskOpacity: 0.95
            },
            // 番茄时钟状态
            pomodoro: {
                timer: null,
                isRunning: false,
                isPaused: false,
                isFocusMode: false,
                totalSeconds: 25 * 60,
                initialSeconds: 25 * 60,
                hours: 0,
                minutes: 25,
                seconds: 0,
                progressCircle: null,
                circumference: 0
            },
            touchState: null,
            tempBackground: null
        };

        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化日期显示
            updateDateDisplay();
            
            // 初始化任务列表
            loadSampleTasks();
            renderTodayTasks();
            
            // 设置事件监听器
            setupEventListeners();
            
            // 加载保存的设置
            loadSettings();
            
            // 应用当前语言
            applyLanguage();
            
            // 应用背景图
            applyBackground();
            
            // 设置触摸事件监听
            setupTouchEvents();
            
            // 初始化番茄时钟显示
            updatePomodoroDisplay();
            initializeProgressCircle();
            
            // 确保首页只显示今日待办
            switchPage('today');
            
            // 初始化番茄时钟页面为普通模式
            const pomodoroPage = document.getElementById('page-pomodoro');
            pomodoroPage.classList.add('normal-mode');
            
            // 初始化添加任务模态框的分类选项
            updateTaskClassificationOptions();
        });
        
        // 初始化进度环
        function initializeProgressCircle() {
            const circle = document.getElementById('progress-circle');
            if (circle) {
                const radius = circle.r.baseVal.value;
                const circumference = 2 * Math.PI * radius;
                
                circle.style.strokeDasharray = `${circumference}`;
                circle.style.strokeDashoffset = circumference;
                
                AppState.pomodoro.progressCircle = circle;
                AppState.pomodoro.circumference = circumference;
            }
        }
        
        // 根据当前清单格式更新任务分类选项
        function updateTaskClassificationOptions() {
            const classificationGroup = document.getElementById('task-classification-group');
            const classificationSelect = document.getElementById('task-classification');
            
            // 清除现有选项
            classificationSelect.innerHTML = '';
            
            // 根据当前清单格式设置选项
            switch (AppState.settings.currentFormat) {
                case 'simple':
                    // 简洁清单不需要分类选项
                    classificationGroup.classList.add('hidden');
                    break;
                    
                case 'quadrant':
                    // 四象限模式
                    classificationGroup.classList.remove('hidden');
                    document.getElementById('task-classification-label').textContent = '四象限分类';
                    
                    const quadrantOptions = [
                        { value: '1', text: '重要且紧急' },
                        { value: '2', text: '重要不紧急' },
                        { value: '3', text: '紧急不重要' },
                        { value: '4', text: '不紧急不重要' }
                    ];
                    
                    quadrantOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option.value;
                        optionElement.textContent = option.text;
                        classificationSelect.appendChild(optionElement);
                    });
                    break;
                    
                case 'priority':
                    // 优先级模式
                    classificationGroup.classList.remove('hidden');
                    document.getElementById('task-classification-label').textContent = '优先级';
                    
                    const priorityOptions = [
                        { value: 'high', text: '高优先级' },
                        { value: 'medium', text: '中优先级' },
                        { value: 'low', text: '低优先级' }
                    ];
                    
                    priorityOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option.value;
                        optionElement.textContent = option.text;
                        if (option.value === 'medium') optionElement.selected = true;
                        classificationSelect.appendChild(optionElement);
                    });
                    break;
            }
        }
        
        // ==================== 清单格式切换功能 ====================
        
        // 根据当前格式渲染任务列表
        function renderTodayTasks() {
            const tasksContainer = document.getElementById('today-tasks');
            tasksContainer.innerHTML = '';
            
            if (AppState.tasks.length === 0) {
                tasksContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <h3>没有待办事项</h3>
                        <p>点击右下角"+"按钮添加新任务</p>
                    </div>
                `;
                return;
            }
            
            // 根据当前格式选择渲染方式
            switch(AppState.settings.currentFormat) {
                case 'simple':
                    renderSimpleTasks();
                    break;
                case 'quadrant':
                    renderQuadrantTasks();
                    break;
                case 'priority':
                    renderPriorityTasks();
                    break;
                default:
                    renderSimpleTasks();
            }
        }
        
        // 渲染简洁清单
        function renderSimpleTasks() {
            const tasksContainer = document.getElementById('today-tasks');
            
            AppState.tasks.forEach(task => {
                const taskElement = createSimpleTaskElement(task);
                tasksContainer.appendChild(taskElement);
            });
        }
        
        // 渲染四象限坐标系
        function renderQuadrantTasks() {
            const tasksContainer = document.getElementById('today-tasks');
            
            // 创建四象限网格容器
            const quadrantGrid = document.createElement('div');
            quadrantGrid.className = 'quadrant-grid';
            
            // 创建坐标轴指示
            const axesContainer = document.createElement('div');
            axesContainer.className = 'quadrant-axes';
            axesContainer.innerHTML = `
                <div class="axis-label important-label">重要</div>
                <div class="axis-label urgent-label">紧急</div>
            `;
            quadrantGrid.appendChild(axesContainer);
            
            // 创建四个象限
            const quadrants = [
                { id: 1, title: '重要且紧急', subtitle: '立即处理', icon: 'fas fa-fire', tasks: [] },
                { id: 2, title: '重要不紧急', subtitle: '计划安排', icon: 'fas fa-calendar-check', tasks: [] },
                { id: 3, title: '紧急不重要', subtitle: '委派他人', icon: 'fas fa-share-alt', tasks: [] },
                { id: 4, title: '不紧急不重要', subtitle: '避免或推迟', icon: 'fas fa-clock', tasks: [] }
            ];
            
            // 将任务分配到对应象限
            AppState.tasks.forEach(task => {
                const quadrant = quadrants.find(q => q.id === (task.quadrant || 4));
                if (quadrant) {
                    quadrant.tasks.push(task);
                }
            });
            
            // 渲染每个象限
            quadrants.forEach(quadrant => {
                const quadrantSection = document.createElement('div');
                quadrantSection.className = `quadrant-section quadrant-${quadrant.id}`;
                
                // 象限头部
                const quadrantHeader = document.createElement('div');
                quadrantHeader.className = 'quadrant-header';
                quadrantHeader.innerHTML = `
                    <div class="quadrant-icon">
                        <i class="${quadrant.icon}"></i>
                    </div>
                    <div>
                        <div class="quadrant-title">${quadrant.title}</div>
                        <div class="quadrant-subtitle">${quadrant.subtitle}</div>
                    </div>
                `;
                
                // 任务容器
                const quadrantTasks = document.createElement('div');
                quadrantTasks.className = 'quadrant-tasks';
                
                if (quadrant.tasks.length > 0) {
                    quadrant.tasks.forEach(task => {
                        const taskElement = createQuadrantTaskElement(task);
                        quadrantTasks.appendChild(taskElement);
                    });
                } else {
                    quadrantTasks.innerHTML = `
                        <div class="quadrant-empty">
                            <i class="fas fa-inbox"></i>
                            <div>暂无任务</div>
                        </div>
                    `;
                }
                
                quadrantSection.appendChild(quadrantHeader);
                quadrantSection.appendChild(quadrantTasks);
                quadrantGrid.appendChild(quadrantSection);
            });
            
            tasksContainer.appendChild(quadrantGrid);
        }
        
        // 渲染优先级清单
        function renderPriorityTasks() {
            const tasksContainer = document.getElementById('today-tasks');
            
            // 按优先级分组
            const priorityGroups = {
                high: [],
                medium: [],
                low: []
            };
            
            AppState.tasks.forEach(task => {
                const priority = task.priority || 'medium';
                priorityGroups[priority].push(task);
            });
            
            // 按优先级顺序渲染
            ['high', 'medium', 'low'].forEach(priority => {
                priorityGroups[priority].forEach(task => {
                    const taskElement = createPriorityTaskElement(task);
                    tasksContainer.appendChild(taskElement);
                });
            });
        }
        
        // 创建简洁清单任务元素
        function createSimpleTaskElement(task) {
            const wrapper = document.createElement('div');
            wrapper.className = 'simple-task-wrapper task-wrapper';
            wrapper.dataset.id = task.id;
            
            const container = document.createElement('div');
            container.className = 'simple-task-container';
            
            const taskElement = document.createElement('div');
            taskElement.className = `simple-task-item`;
            if (task.completed) {
                taskElement.classList.add(`completed`);
            }
            
            // 删除指示器
            const deleteIndicator = document.createElement('div');
            deleteIndicator.className = 'delete-indicator';
            deleteIndicator.innerHTML = '<i class="fas fa-trash"></i>';
            
            const checkboxContainer = document.createElement('div');
            checkboxContainer.className = 'checkbox-container';
            
            const checkbox = document.createElement('div');
            checkbox.className = `simple-task-checkbox ${task.completed ? 'checked' : ''}`;
            checkbox.innerHTML = '<i class="fas fa-check"></i>';
            checkboxContainer.appendChild(checkbox);
            
            checkbox.addEventListener('click', function(e) {
                e.stopPropagation();
                toggleTaskCompletion(task.id);
            });
            
            const content = document.createElement('div');
            content.className = 'simple-task-content';
            content.textContent = task.text;
            
            taskElement.appendChild(checkboxContainer);
            taskElement.appendChild(content);
            taskElement.appendChild(deleteIndicator);
            
            container.appendChild(taskElement);
            wrapper.appendChild(container);
            
            return wrapper;
        }
        
        // 创建四象限任务元素
        function createQuadrantTaskElement(task) {
            const taskElement = document.createElement('div');
            taskElement.className = `quadrant-task-item`;
            taskElement.dataset.id = task.id;
            
            if (task.completed) {
                taskElement.classList.add(`completed`);
            }
            
            // 删除指示器
            const deleteIndicator = document.createElement('div');
            deleteIndicator.className = 'delete-indicator';
            deleteIndicator.innerHTML = '<i class="fas fa-trash"></i>';
            deleteIndicator.style.right = '10px';
            
            const content = document.createElement('div');
            content.className = 'quadrant-task-content';
            content.textContent = task.text;
            
            taskElement.appendChild(content);
            taskElement.appendChild(deleteIndicator);
            
            taskElement.addEventListener('click', function(e) {
                toggleTaskCompletion(task.id);
            });
            
            return taskElement;
        }
        
        // 创建优先级清单任务元素
        function createPriorityTaskElement(task) {
            const wrapper = document.createElement('div');
            wrapper.className = 'priority-task-wrapper task-wrapper';
            wrapper.dataset.id = task.id;
            
            const container = document.createElement('div');
            container.className = 'priority-task-container';
            
            const taskElement = document.createElement('div');
            taskElement.className = `priority-task-item`;
            if (task.completed) {
                taskElement.classList.add(`completed`);
            }
            
            // 删除指示器
            const deleteIndicator = document.createElement('div');
            deleteIndicator.className = 'delete-indicator';
            deleteIndicator.innerHTML = '<i class="fas fa-trash"></i>';
            
            const priorityIndicator = document.createElement('div');
            priorityIndicator.className = `priority-indicator priority-${task.priority || 'medium'}`;
            priorityIndicator.innerHTML = task.priority === 'high' ? '高' : (task.priority === 'medium' ? '中' : '低');
            
            const content = document.createElement('div');
            content.className = 'priority-task-content';
            content.textContent = task.text;
            
            taskElement.appendChild(priorityIndicator);
            taskElement.appendChild(content);
            taskElement.appendChild(deleteIndicator);
            
            taskElement.addEventListener('click', function(e) {
                if (!e.target.closest('.priority-indicator')) {
                    toggleTaskCompletion(task.id);
                }
            });
            
            container.appendChild(taskElement);
            wrapper.appendChild(container);
            
            return wrapper;
        }
        
        // ==================== 设置格式选项 ====================
        
        // 设置格式选项
        function setupFormatOptions() {
            const formatOptions = document.querySelectorAll('.format-option');
            formatOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // 移除所有选中状态
                    formatOptions.forEach(opt => opt.classList.remove('selected'));
                    // 添加当前选中状态
                    this.classList.add('selected');
                    
                    const format = this.dataset.format;
                    AppState.settings.currentFormat = format;
                    saveSettings();
                    
                    // 立即更新首页任务显示
                    renderTodayTasks();
                    
                    // 更新添加任务模态框的分类选项
                    updateTaskClassificationOptions();
                    
                    showSimpleReminder(`已切换到${this.querySelector('.format-name').textContent}`);
                });
            });
        }
        
        // 切换专注模式
        function toggleFocusMode(enable) {
            const pomodoroPage = document.getElementById('page-pomodoro');
            
            AppState.pomodoro.isFocusMode = enable;
            
            if (enable) {
                // 进入专注模式
                pomodoroPage.classList.remove('normal-mode');
                pomodoroPage.classList.add('focus-mode');
                document.getElementById('focus-status').textContent = '专注中...';
            } else {
                // 退出专注模式
                pomodoroPage.classList.remove('focus-mode');
                pomodoroPage.classList.add('normal-mode');
                document.getElementById('focus-status').textContent = '准备开始专注';
            }
        }
        
        // ==================== 番茄时钟功能 ====================
        
        // 更新番茄时钟显示
        function updatePomodoroDisplay() {
            const totalSeconds = AppState.pomodoro.totalSeconds;
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            // 格式化为00:25:00样式
            const displayText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('pomodoro-timer').textContent = displayText;
            document.getElementById('focus-timer').textContent = displayText;
            
            // 更新进度环
            if (AppState.pomodoro.isFocusMode) {
                updateProgressCircle();
            }
            
            // 更新按钮状态
            const timerElement = document.getElementById('pomodoro-timer');
            const focusTimerElement = document.getElementById('focus-timer');
            if (AppState.pomodoro.isRunning && !AppState.pomodoro.isPaused) {
                timerElement.classList.add('active');
                focusTimerElement.classList.add('active');
            } else {
                timerElement.classList.remove('active');
                focusTimerElement.classList.remove('active');
            }
        }
        
        // 更新进度环
        function updateProgressCircle() {
            if (!AppState.pomodoro.progressCircle) return;
            
            const progress = ((AppState.pomodoro.initialSeconds - AppState.pomodoro.totalSeconds) / AppState.pomodoro.initialSeconds) * 100;
            const offset = AppState.pomodoro.circumference - (progress / 100) * AppState.pomodoro.circumference;
            AppState.pomodoro.progressCircle.style.strokeDashoffset = offset;
        }
        
        // 开始番茄时钟
        function startPomodoro() {
            if (AppState.pomodoro.isRunning && !AppState.pomodoro.isPaused) {
                return;
            }
            
            if (AppState.pomodoro.isPaused) {
                AppState.pomodoro.isPaused = false;
            } else {
                AppState.pomodoro.isRunning = true;
                AppState.pomodoro.initialSeconds = AppState.pomodoro.totalSeconds;
            }
            
            // 进入专注模式
            if (!AppState.pomodoro.isFocusMode) {
                toggleFocusMode(true);
            }
            
            // 清除现有定时器
            if (AppState.pomodoro.timer) {
                clearInterval(AppState.pomodoro.timer);
            }
            
            // 设置新定时器
            AppState.pomodoro.timer = setInterval(function() {
                if (AppState.pomodoro.totalSeconds > 0) {
                    AppState.pomodoro.totalSeconds--;
                    updatePomodoroDisplay();
                    
                    if (AppState.pomodoro.totalSeconds === 0) {
                        completePomodoro();
                    }
                }
            }, 1000);
            
            updatePomodoroDisplay();
            showSimpleReminder('专注时钟已启动');
        }
        
        // 暂停番茄时钟
        function pausePomodoro() {
            if (!AppState.pomodoro.isRunning) return;
            
            AppState.pomodoro.isPaused = true;
            
            if (AppState.pomodoro.timer) {
                clearInterval(AppState.pomodoro.timer);
                AppState.pomodoro.timer = null;
            }
            
            // 退出专注模式
            if (AppState.pomodoro.isFocusMode) {
                toggleFocusMode(false);
            }
            
            updatePomodoroDisplay();
            showSimpleReminder('时钟已暂停');
        }
        
        // 重置番茄时钟
        function resetPomodoro() {
            if (AppState.pomodoro.timer) {
                clearInterval(AppState.pomodoro.timer);
                AppState.pomodoro.timer = null;
            }
            
            AppState.pomodoro.isRunning = false;
            AppState.pomodoro.isPaused = false;
            
            // 退出专注模式
            if (AppState.pomodoro.isFocusMode) {
                toggleFocusMode(false);
            }
            
            updatePomodoroTotalSeconds();
            AppState.pomodoro.initialSeconds = AppState.pomodoro.totalSeconds;
            updatePomodoroDisplay();
            
            // 重置进度环
            if (AppState.pomodoro.progressCircle) {
                AppState.pomodoro.progressCircle.style.strokeDashoffset = AppState.pomodoro.circumference;
            }
            
            showSimpleReminder('时钟已重置');
        }
        
        // 完成番茄时钟
        function completePomodoro() {
            if (AppState.pomodoro.timer) {
                clearInterval(AppState.pomodoro.timer);
                AppState.pomodoro.timer = null;
            }
            
            AppState.pomodoro.isRunning = false;
            AppState.pomodoro.isPaused = false;
            
            // 退出专注模式
            if (AppState.pomodoro.isFocusMode) {
                toggleFocusMode(false);
                
                // 播放完成动画
                const timerElements = [document.getElementById('pomodoro-timer'), document.getElementById('focus-timer')];
                timerElements.forEach(element => {
                    element.style.color = 'var(--success-color)';
                    setTimeout(() => {
                        element.style.color = '#000000';
                    }, 2000);
                });
            }
            
            // 进度环完成动画
            updateProgressCircle();
            
            showSimpleReminder('番茄时钟完成！休息一下吧。');
        }
        
        // 应用番茄时钟设置
        function applyPomodoroSettings() {
            const hours = parseInt(document.getElementById('pomodoro-hours').value) || 0;
            const minutes = parseInt(document.getElementById('pomodoro-minutes').value) || 0;
            const seconds = parseInt(document.getElementById('pomodoro-seconds').value) || 0;
            
            if (hours < 0 || hours > 10) {
                alert('小时数应在0-10之间');
                return;
            }
            
            if (minutes < 0 || minutes > 59) {
                alert('分钟数应在0-59之间');
                return;
            }
            
            if (seconds < 0 || seconds > 59) {
                alert('秒数应在0-59之间');
                return;
            }
            
            AppState.pomodoro.hours = hours;
            AppState.pomodoro.minutes = minutes;
            AppState.pomodoro.seconds = seconds;
            
            updatePomodoroTotalSeconds();
            AppState.pomodoro.initialSeconds = AppState.pomodoro.totalSeconds;
            resetPomodoro();
            
            // 添加应用按钮动画反馈
            const applyBtn = document.getElementById('pomodoro-apply-btn');
            applyBtn.style.transform = 'scale(1.1)';
            setTimeout(() => {
                applyBtn.style.transform = 'scale(1)';
            }, 300);
            
            showSimpleReminder('时间设置已更新');
        }
        
        // 更新番茄时钟总秒数
        function updatePomodoroTotalSeconds() {
            AppState.pomodoro.totalSeconds = 
                AppState.pomodoro.hours * 3600 + 
                AppState.pomodoro.minutes * 60 + 
                AppState.pomodoro.seconds;
        }
        
        // ==================== 背景图片功能修复 ====================
        
        // 修复背景图片功能
        function setupBackgroundControls() {
            const fileInput = document.getElementById('local-image-upload');
            const clearBgBtn = document.getElementById('clear-bg');
            const saveBgBtn = document.getElementById('save-bg');
            const fileName = document.getElementById('file-name');
            const bgPreview = document.getElementById('bg-preview');
            
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        fileName.textContent = file.name;
                        
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            const imageUrl = event.target.result;
                            
                            // 预览图片
                            bgPreview.style.backgroundImage = `url('${imageUrl}')`;
                            bgPreview.classList.add('active');
                            
                            // 临时应用到背景
                            document.getElementById('today-background').style.backgroundImage = `url('${imageUrl}')`;
                            
                            // 保存到临时状态
                            AppState.tempBackground = imageUrl;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            if (clearBgBtn) {
                clearBgBtn.addEventListener('click', function() {
                    document.getElementById('today-background').style.backgroundImage = '';
                    bgPreview.style.backgroundImage = '';
                    bgPreview.classList.remove('active');
                    fileName.textContent = '';
                    fileInput.value = '';
                    
                    // 保存设置
                    AppState.settings.background = 'none';
                    AppState.settings.customBackground = '';
                    saveSettings();
                    
                    showSimpleReminder('背景已清除');
                });
            }
            
            if (saveBgBtn) {
                saveBgBtn.addEventListener('click', function() {
                    if (AppState.tempBackground) {
                        AppState.settings.background = 'custom';
                        AppState.settings.customBackground = AppState.tempBackground;
                        saveSettings();
                        
                        showSimpleReminder('背景已保存');
                    } else {
                        showSimpleReminder('请先选择图片');
                    }
                });
            }
        }
        
        // ==================== 其他功能 ====================
        
        // 简单提醒功能
        function showSimpleReminder(message) {
            const reminder = document.getElementById('simple-reminder');
            document.getElementById('reminder-text').textContent = message;
            
            reminder.style.display = 'flex';
            
            setTimeout(() => {
                reminder.style.display = 'none';
            }, 3000);
        }
        
        // 切换页面
        function switchPage(page) {
            // 隐藏所有页面
            document.getElementById('page-today').classList.remove('active');
            document.getElementById('page-settings').classList.remove('active');
            document.getElementById('page-pomodoro').classList.remove('active');
            
            // 隐藏添加任务按钮和滑动提示（只在今日页面显示）
            document.getElementById('add-task-button').style.display = 'none';
            document.getElementById('swipe-instruction').style.display = 'none';
            
            // 显示目标页面
            document.getElementById('page-' + page).classList.add('active');
            
            // 如果是今日页面，显示添加任务按钮和滑动提示
            if (page === 'today') {
                document.getElementById('add-task-button').style.display = 'flex';
                document.getElementById('swipe-instruction').style.display = 'block';
            }
            
            AppState.currentPage = page;
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            // 页面导航按钮
            document.getElementById('nav-button').addEventListener('click', function() {
                switchPage('settings');
            });
            
            document.getElementById('settings-back-button').addEventListener('click', function() {
                switchPage('today');
            });
            
            document.getElementById('pomodoro-back-button').addEventListener('click', function() {
                // 退出专注模式（如果正在运行）
                if (AppState.pomodoro.isRunning && !AppState.pomodoro.isPaused) {
                    pausePomodoro();
                }
                switchPage('settings');
            });
            
            // 添加任务按钮
            document.getElementById('add-task-button').addEventListener('click', openAddTaskModal);
            
            // 模态框关闭按钮
            document.getElementById('modal-close').addEventListener('click', closeModal);
            document.getElementById('cancel-btn').addEventListener('click', closeModal);
            
            // 保存任务按钮
            document.getElementById('save-task-btn').addEventListener('click', saveNewTasks);
            
            // 番茄时钟按钮 - 从设置页面跳转到番茄时钟独立页面
            document.getElementById('pomodoro-btn').addEventListener('click', function() {
                switchPage('pomodoro');
            });
            
            // 番茄时钟控制
            document.getElementById('pomodoro-start-btn').addEventListener('click', startPomodoro);
            document.getElementById('pomodoro-pause-btn').addEventListener('click', pausePomodoro);
            document.getElementById('pomodoro-reset-btn').addEventListener('click', resetPomodoro);
            document.getElementById('pomodoro-apply-btn').addEventListener('click', applyPomodoroSettings);
            document.getElementById('pomodoro-focus-pause').addEventListener('click', pausePomodoro);
            
            // 背景图片控制
            setupBackgroundControls();
            
            // 透明度控制
            setupOpacityControls();
            
            // 格式选项
            setupFormatOptions();
        }
        
        // 设置透明度控制
        function setupOpacityControls() {
            const bgOpacitySlider = document.getElementById('bg-opacity-slider');
            const taskOpacitySlider = document.getElementById('task-opacity-slider');
            const bgOpacityValue = document.getElementById('bg-opacity-value');
            const taskOpacityValue = document.getElementById('task-opacity-value');
            
            if (bgOpacitySlider && bgOpacityValue) {
                bgOpacitySlider.addEventListener('input', function() {
                    const value = this.value;
                    bgOpacityValue.textContent = value + '%';
                    AppState.settings.bgOpacity = value / 100;
                    applyBackgroundOpacity();
                    saveSettings();
                });
            }
            
            if (taskOpacitySlider && taskOpacityValue) {
                taskOpacitySlider.addEventListener('input', function() {
                    const value = this.value;
                    taskOpacityValue.textContent = value + '%';
                    AppState.settings.taskOpacity = value / 100;
                    applyTaskOpacity();
                    saveSettings();
                });
            }
        }
        
        // 应用任务透明度
        function applyTaskOpacity() {
            document.documentElement.style.setProperty('--task-opacity', AppState.settings.taskOpacity);
        }
        
        // 打开添加任务模态框
        function openAddTaskModal() {
            // 更新分类选项以匹配当前清单格式
            updateTaskClassificationOptions();
            
            document.getElementById('add-task-modal').classList.add('active');
            document.getElementById('task-text').focus();
        }
        
        // 关闭模态框
        function closeModal() {
            document.getElementById('add-task-modal').classList.remove('active');
            document.getElementById('task-text').value = '';
        }
        
        // 保存新任务
        function saveNewTasks() {
            const text = document.getElementById('task-text').value.trim();
            
            if (text === '') {
                alert('请输入任务内容');
                return;
            }
            
            const taskLines = text.split('\n').filter(line => line.trim() !== '');
            
            taskLines.forEach(taskText => {
                const newTask = {
                    id: Date.now() + Math.random(),
                    text: taskText.trim(),
                    completed: false
                };
                
                // 根据当前清单格式添加相应的分类信息
                const currentFormat = AppState.settings.currentFormat;
                const classificationSelect = document.getElementById('task-classification');
                
                if (currentFormat === 'quadrant' && classificationSelect) {
                    newTask.quadrant = parseInt(classificationSelect.value) || 4;
                } else if (currentFormat === 'priority' && classificationSelect) {
                    newTask.priority = classificationSelect.value || 'medium';
                }
                // 简洁清单不需要额外分类信息
                
                AppState.tasks.push(newTask);
            });
            
            saveTasks();
            renderTodayTasks();
            closeModal();
            
            showSimpleReminder(`成功添加 ${taskLines.length} 个任务`);
        }
        
        // 更新日期显示
        function updateDateDisplay() {
            const now = new Date();
            const lang = AppState.settings.language;
            
            let dateString;
            if (lang === 'zh-CN') {
                const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
                dateString = now.toLocaleDateString('zh-CN', options);
            } else {
                const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
                dateString = now.toLocaleDateString('en-US', options);
            }
            
            document.getElementById('date-text').textContent = dateString;
        }
        
        // 加载示例任务
        function loadSampleTasks() {
            AppState.tasks = [
                { id: 1, text: '完成项目报告', completed: false, quadrant: 1, priority: 'high' },
                { id: 2, text: '健身30分钟', completed: true, quadrant: 2, priority: 'medium' },
                { id: 3, text: '购买日常用品', completed: false, quadrant: 4, priority: 'low' },
                { id: 4, text: '回复工作邮件', completed: false, quadrant: 1, priority: 'high' }
            ];
        }
        
        // 切换任务完成状态
        function toggleTaskCompletion(taskId) {
            const taskIndex = AppState.tasks.findIndex(task => task.id === taskId);
            if (taskIndex !== -1) {
                AppState.tasks[taskIndex].completed = !AppState.tasks[taskIndex].completed;
                saveTasks();
                renderTodayTasks();
            }
        }
        
        // 删除任务
        function deleteTask(taskId) {
            const taskIndex = AppState.tasks.findIndex(task => task.id == taskId);
            if (taskIndex !== -1) {
                AppState.tasks.splice(taskIndex, 1);
                saveTasks();
                renderTodayTasks();
            }
        }
        
        // 设置触摸事件
        function setupTouchEvents() {
            const tasksContainer = document.getElementById('today-tasks');
            
            tasksContainer.addEventListener('touchstart', handleTouchStart, { passive: true });
            tasksContainer.addEventListener('touchmove', handleTouchMove, { passive: false });
            tasksContainer.addEventListener('touchend', handleTouchEnd);
            
            tasksContainer.addEventListener('mousedown', handleMouseStart);
            tasksContainer.addEventListener('mousemove', handleMouseMove);
            tasksContainer.addEventListener('mouseup', handleMouseEnd);
            tasksContainer.addEventListener('mouseleave', handleMouseLeave);
        }
        
        // 触摸事件处理
        function handleTouchStart(e) {
            const touch = e.touches[0];
            let target = e.target.closest('.task-wrapper');
            if (!target) {
                target = e.target.closest('.quadrant-task-item');
            }
            
            if (!target) return;
            
            let taskContainer, taskElement;
            
            if (target.classList.contains('quadrant-task-item')) {
                taskContainer = target;
                taskElement = target;
            } else {
                taskContainer = target.querySelector('.simple-task-container') || 
                                target.querySelector('.priority-task-container');
                taskElement = target.querySelector('.simple-task-item') || 
                              target.querySelector('.priority-task-item');
            }
            
            if (!taskContainer || !taskElement) return;
            
            AppState.touchState = {
                startX: touch.clientX,
                startY: touch.clientY,
                currentX: touch.clientX,
                isSwiping: false,
                currentElement: taskContainer,
                taskElement: taskElement,
                taskWrapper: target,
                threshold: 80
            };
            
            if (taskContainer.classList) {
                taskContainer.classList.add('swiping');
            }
        }
        
        function handleTouchMove(e) {
            if (!AppState.touchState || !AppState.touchState.currentElement) return;
            
            const touch = e.touches[0];
            const deltaX = touch.clientX - AppState.touchState.startX;
            const deltaY = touch.clientY - AppState.touchState.startY;
            
            if (Math.abs(deltaY) > Math.abs(deltaX) && !AppState.touchState.isSwiping) {
                return;
            }
            
            e.preventDefault();
            
            AppState.touchState.isSwiping = true;
            AppState.touchState.currentX = touch.clientX;
            
            const translateX = Math.min(0, deltaX);
            
            AppState.touchState.currentElement.style.transform = `translateX(${translateX}px)`;
            
            // 显示删除指示器
            if (deltaX < -30) {
                if (AppState.touchState.taskElement.classList) {
                    AppState.touchState.taskElement.classList.add('swipe-to-delete');
                }
                
                // 根据滑动距离改变指示器透明度
                const progress = Math.min(1, Math.abs(deltaX) / 100);
                const indicator = AppState.touchState.taskElement.querySelector('.delete-indicator');
                if (indicator) {
                    indicator.style.opacity = progress;
                    indicator.style.color = progress > 0.7 ? '#ef4444' : '#94a3b8';
                }
            } else {
                if (AppState.touchState.taskElement.classList) {
                    AppState.touchState.taskElement.classList.remove('swipe-to-delete');
                }
            }
        }
        
        function handleTouchEnd(e) {
            if (!AppState.touchState || !AppState.touchState.currentElement) return;
            
            const wrapper = AppState.touchState.taskWrapper;
            const deltaX = AppState.touchState.currentX - AppState.touchState.startX;
            
            if (AppState.touchState.currentElement.classList) {
                AppState.touchState.currentElement.classList.remove('swiping');
            }
            if (AppState.touchState.taskElement.classList) {
                AppState.touchState.taskElement.classList.remove('swipe-to-delete');
            }
            
            // 如果左滑距离超过阈值，直接删除任务
            if (deltaX < -AppState.touchState.threshold && AppState.touchState.isSwiping) {
                // 添加删除动画
                wrapper.classList.add('deleting');
                
                const taskId = wrapper.dataset.id;
                
                // 等待动画完成后删除任务
                setTimeout(() => {
                    deleteTask(taskId);
                }, 300);
            } else {
                // 否则回弹到原位
                AppState.touchState.currentElement.style.transform = 'translateX(0)';
                AppState.touchState.currentElement.style.transition = 'transform 0.3s cubic-bezier(0.2, 0, 0, 1)';
                
                // 隐藏删除指示器
                const indicator = AppState.touchState.taskElement.querySelector('.delete-indicator');
                if (indicator) {
                    indicator.style.opacity = 0;
                }
            }
            
            AppState.touchState = null;
        }
        
        function handleMouseStart(e) {
            let target = e.target.closest('.task-wrapper');
            if (!target) {
                target = e.target.closest('.quadrant-task-item');
            }
            
            if (!target) return;
            
            let taskContainer, taskElement;
            
            if (target.classList.contains('quadrant-task-item')) {
                taskContainer = target;
                taskElement = target;
            } else {
                taskContainer = target.querySelector('.simple-task-container') || 
                                target.querySelector('.priority-task-container');
                taskElement = target.querySelector('.simple-task-item') || 
                              target.querySelector('.priority-task-item');
            }
            
            if (!taskContainer || !taskElement) return;
            
            AppState.touchState = {
                startX: e.clientX,
                startY: e.clientY,
                currentX: e.clientX,
                isSwiping: false,
                currentElement: taskContainer,
                taskElement: taskElement,
                taskWrapper: target,
                threshold: 80
            };
            
            if (taskContainer.classList) {
                taskContainer.classList.add('swiping');
            }
        }
        
        function handleMouseMove(e) {
            if (!AppState.touchState || !AppState.touchState.currentElement) return;
            
            const deltaX = e.clientX - AppState.touchState.startX;
            const deltaY = e.clientY - AppState.touchState.startY;
            
            if (Math.abs(deltaY) > Math.abs(deltaX) && !AppState.touchState.isSwiping) {
                return;
            }
            
            AppState.touchState.isSwiping = true;
            AppState.touchState.currentX = e.clientX;
            
            const translateX = Math.min(0, deltaX);
            
            AppState.touchState.currentElement.style.transform = `translateX(${translateX}px)`;
            
            // 显示删除指示器
            if (deltaX < -30) {
                if (AppState.touchState.taskElement.classList) {
                    AppState.touchState.taskElement.classList.add('swipe-to-delete');
                }
                
                // 根据滑动距离改变指示器透明度
                const progress = Math.min(1, Math.abs(deltaX) / 100);
                const indicator = AppState.touchState.taskElement.querySelector('.delete-indicator');
                if (indicator) {
                    indicator.style.opacity = progress;
                    indicator.style.color = progress > 0.7 ? '#ef4444' : '#94a3b8';
                }
            } else {
                if (AppState.touchState.taskElement.classList) {
                    AppState.touchState.taskElement.classList.remove('swipe-to-delete');
                }
            }
        }
        
        function handleMouseEnd(e) {
            if (!AppState.touchState || !AppState.touchState.currentElement) return;
            
            const wrapper = AppState.touchState.taskWrapper;
            const deltaX = AppState.touchState.currentX - AppState.touchState.startX;
            
            if (AppState.touchState.currentElement.classList) {
                AppState.touchState.currentElement.classList.remove('swiping');
            }
            if (AppState.touchState.taskElement.classList) {
                AppState.touchState.taskElement.classList.remove('swipe-to-delete');
            }
            
            // 如果左滑距离超过阈值，直接删除任务
            if (deltaX < -AppState.touchState.threshold && AppState.touchState.isSwiping) {
                // 添加删除动画
                wrapper.classList.add('deleting');
                
                const taskId = wrapper.dataset.id;
                
                // 等待动画完成后删除任务
                setTimeout(() => {
                    deleteTask(taskId);
                }, 300);
            } else {
                // 否则回弹到原位
                AppState.touchState.currentElement.style.transform = 'translateX(0)';
                AppState.touchState.currentElement.style.transition = 'transform 0.3s cubic-bezier(0.2, 0, 0, 1)';
                
                // 隐藏删除指示器
                const indicator = AppState.touchState.taskElement.querySelector('.delete-indicator');
                if (indicator) {
                    indicator.style.opacity = 0;
                }
            }
            
            AppState.touchState = null;
        }
        
        function handleMouseLeave(e) {
            if (AppState.touchState && AppState.touchState.currentElement) {
                handleMouseEnd(e);
            }
        }
        
        // 应用背景图
        function applyBackground() {
            const backgroundDiv = document.getElementById('today-background');
            const bg = AppState.settings.background;
            
            backgroundDiv.style.backgroundImage = '';
            backgroundDiv.style.backgroundColor = '';
            backgroundDiv.style.display = 'block';
            
            if (bg === 'none') {
                backgroundDiv.style.display = 'none';
            } else if (bg === 'custom' && AppState.settings.customBackground) {
                backgroundDiv.style.backgroundImage = `url('${AppState.settings.customBackground}')`;
                backgroundDiv.style.backgroundSize = 'cover';
                backgroundDiv.style.backgroundPosition = 'center';
            }
            
            applyBackgroundOpacity();
        }
        
        // 应用背景透明度
        function applyBackgroundOpacity() {
            const backgroundDiv = document.getElementById('today-background');
            backgroundDiv.style.opacity = AppState.settings.bgOpacity;
        }
        
        // 应用语言设置
        function applyLanguage() {
            // 简化的语言设置
        }
        
        // 保存任务到本地存储
        function saveTasks() {
            localStorage.setItem('daily-tasks', JSON.stringify(AppState.tasks));
        }
        
        // 保存设置到本地存储
        function saveSettings() {
            localStorage.setItem('daily-settings', JSON.stringify(AppState.settings));
        }
        
        // 从本地存储加载设置
        function loadSettings() {
            const savedSettings = localStorage.getItem('daily-settings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                AppState.settings = { ...AppState.settings, ...settings };
                
                // 更新UI
                document.getElementById('bg-opacity-slider').value = AppState.settings.bgOpacity * 100;
                document.getElementById('bg-opacity-value').textContent = (AppState.settings.bgOpacity * 100) + '%';
                document.getElementById('task-opacity-slider').value = AppState.settings.taskOpacity * 100;
                document.getElementById('task-opacity-value').textContent = (AppState.settings.taskOpacity * 100) + '%';
                
                applyTaskOpacity();
                
                // 更新格式选项选中状态
                const formatOptions = document.querySelectorAll('.format-option');
                formatOptions.forEach(option => {
                    if (option.dataset.format === AppState.settings.currentFormat) {
                        option.classList.add('selected');
                    } else {
                        option.classList.remove('selected');
                    }
                });
            }
            
            const savedTasks = localStorage.getItem('daily-tasks');
            if (savedTasks) {
                AppState.tasks = JSON.parse(savedTasks);
                renderTodayTasks();
            }
        }
    </script>
</body>
</html>